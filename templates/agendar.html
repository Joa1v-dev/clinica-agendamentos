<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Agendar Consulta</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <div class="container">
        <h2>üìÖ Agendar Consulta</h2>
        <a href="{{ url_for('home') }}" class="btn-secondary">‚Üê Voltar ao In√≠cio</a><br><br>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-message">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}
        {% endwith %}

        <form method="POST" class="form">
            <label for="usuario">Paciente</label>
            <a href="{{ url_for('cadastro_usuario') }}" class="btn-secondary" style="margin-bottom: 15px;">‚ûï Cadastrar Novo Paciente</a>

            <select name="usuario" id="usuario" required>
                <option value="">Selecione um paciente</option>
                {% for u in usuarios %}
                    <option value="{{ u['id'] }}">{{ u['nome'] }}</option>
                {% endfor %}
            </select>

            <label for="medico">M√©dico</label>
            <select name="medico" id="medico" required>
                <option value="">Selecione um m√©dico</option>
                {% for medico in medicos %}
                    <option value="{{ medico['id'] }}">{{ medico['nome'] }}</option>
                {% endfor %}
            </select>

            <label for="agenda">Hor√°rio e Data</label>
            <select name="agenda" id="agenda" required>
                <option value="">Escolha um m√©dico primeiro</option>
            </select>

            <button type="submit" class="btn-primary">‚úÖ Confirmar Agendamento</button>
        </form>
    </div>

    <script>
    document.getElementById('medico').addEventListener('change', function() {
        const medicoId = this.value;
        const selectAgenda = document.getElementById('agenda');
        selectAgenda.innerHTML = '<option value="">Carregando hor√°rios...</option>';

        if (!medicoId) {
            selectAgenda.innerHTML = '<option value="">Escolha um m√©dico primeiro</option>';
            return;
        }

        fetch(`/horarios/${medicoId}`)
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    selectAgenda.innerHTML = '<option value="">Nenhum hor√°rio dispon√≠vel</option>';
                    return;
                }
                let options = '<option value="">Selecione um hor√°rio</option>';
                data.forEach(item => {
                    options += `<option value="${item.id}">${item.descricao}</option>`;
                });
                selectAgenda.innerHTML = options;
            })
            .catch(err => {
                console.error('Erro ao carregar hor√°rios:', err);
                selectAgenda.innerHTML = '<option value="">Erro ao carregar hor√°rios</option>';
            });
    });
    </script>
</body>
</html>
